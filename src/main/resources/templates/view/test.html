<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>영화 예고편 재생기</title>
  <style>
    .movie-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      padding: 20px;
    }
    .movie {
      cursor: pointer;
      width: 150px;
    }
    .movie img {
      width: 100%;
      height: auto;
    }
    .modal {
      display: none;
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
    }
    .close {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 1.5em;
    }
  </style>
</head>
<body>

<div class="movie-container" id="movie-container">
  <!-- 영화 목록이 여기에 표시됩니다 -->
</div>

<div class="modal" id="trailer-modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">×</span>
    <iframe id="trailer-iframe" width="560" height="315" src="" frameborder="0" allowfullscreen></iframe>
  </div>
</div>

<script>
  const tmdbApiKey = '91ebb9f602d1cc08e13c77f2f2aa8ab0';
  const movieContainer = document.getElementById('movie-container');
  const trailerModal = document.getElementById('trailer-modal');
  const trailerIframe = document.getElementById('trailer-iframe');

  // TMDB에서 인기 영화 목록을 가져오는 함수
  function fetchPopularMovies() {
    fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${tmdbApiKey}&language=ko-KR&page=1`)
            .then(response => response.json())
            .then(data => {
              data.results.forEach(movie => {
                const movieEl = document.createElement('div');
                movieEl.classList.add('movie');
                movieEl.innerHTML = `
                    <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}">
                    <h3>${movie.title}</h3>
                `;
                movieEl.addEventListener('click', () => {
                  fetchTrailer(movie.id);
                });
                movieContainer.appendChild(movieEl);
              });
            });
  }

  // 선택한 영화의 예고편을 가져오는 함수
  function fetchTrailer(movieId) {
    fetch(`https://api.themoviedb.org/3/movie/${movieId}/videos?api_key=${tmdbApiKey}&language=ko-KR`)
            .then(response => response.json())
            .then(data => {
              const trailer = data.results.find(video => video.type === 'Trailer');
              if (trailer) {
                const youtubeUrl = `https://www.youtube.com/embed/${trailer.key}`;
                trailerIframe.src = youtubeUrl;
                trailerModal.style.display = 'flex';
              } else {
                alert('예고편을 찾을 수 없습니다.');
              }
            });
  }

  // 모달 닫기 함수
  function closeModal() {
    trailerModal.style.display = 'none';
    trailerIframe.src = '';
  }

  // 페이지 로드 시 인기 영화 목록을 가져옴
  fetchPopularMovies();
</script>

</body>
</html>
